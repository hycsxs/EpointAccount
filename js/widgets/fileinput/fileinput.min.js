!function(){"use strict";var t={type:"ALL",isMulti:!1,container:""};function e(e){e=Util.extend({},t,e),this.container=Util.selector(e.container),this.options=e,this._init(),this._addEvent()}e.prototype={_init:function(){var e=Util.os.ejs,t=this.options,i=this.container;i.setAttribute("type","file"),t.isMulti?i.setAttribute("multiple","multiple"):i.removeAttribute("multiple");var a,n=t.accept||i.getAttribute("accept"),r=t.type||"File",l=Util.os.android,r="Image"===r?(a="image/*","DataUrl"):"Camera"===r?(a=e&&l?"camera/*":"image/*","DataUrl"):"Image_Camera"===r?(a=e&&l?"image_camera/*":"image/*","DataUrl"):"Image_File"===r?(a=e&&l?"image_file/*":"*","DataUrl"):"Camera_File"===r?(a=e&&l?"camera_file/*":"*","DataUrl"):"Text"===r?(a=e&&l?"text/*":"file/*","Text"):"File"===r?e&&l?(a="file/*","DataUrl"):(a="*","File"):"All"===r?(a=e&&l?"*/*":"*","DataUrl"):(a="*","File");this.dataType=r,a=n||a,i.setAttribute("accept",a)},_addEvent:function(){function e(){var e,t,i,a=r.files,n=a.length;0!==n&&(e=new window.FileReader,t=0,(i=function(){n<=t||function(e,n,r,t,l){if(window.FileReader||!e||!(e instanceof FileReader))return e.onload=function(e){var t,i,a=e.target.result;"DataUrl"===l&&a&&-1!==a.indexOf("data:base64,")&&(a=a.replace("data:base64,",""),t="",(i=n.name)&&-1!==i.toLowerCase().indexOf(".jpg")?t="image/jpeg":i&&-1!==i.toLowerCase().indexOf(".png")?t="image/png":i&&-1!==i.toLowerCase().indexOf(".gif")?t="image/gif":i&&-1!==i.toLowerCase().indexOf(".icon")&&(t="image/x-icon"),a="data:"+t+";base64,"+a),r&&r(a)},e.onerror=function(e){e&&e(e)},"DataUrl"===l?e.readAsDataURL(n):"Text"===l?e.readAsText(n):e.readAsBinaryString(n);t&&t("错误:FileReader不存在!")}(e,a[t],function(e){l&&l(e,a[t],{index:t,len:n,isEnd:n-1<=t}),t++,i()},o,s.dataType)})())}var r=this.container,t=this.options,l=t.success,o=t.error,s=this;r.addEventListener("change",e),this.delegatesHandle=e},destroy:function(){this.container.removeEventListener("change",this.delegatesHandle),this.container=null,this.options=null}},window.FileInput=e}();