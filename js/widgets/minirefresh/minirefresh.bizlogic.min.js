!function(t){"use strict";var e=t.MiniRefreshBiz||function(){"use strict";var t="log",f="warn",l="error",o=window.MiniRefreshTools,r=window.MiniRefresh,p=window.Mustache,n=window.mui,d=Util.ajax,e=Util.dataProcess,i,s="ontouchstart"in document?"tap":"click",u={isDebug:false,container:"#minirefresh",listContainer:"#listdata",type:"POST",initPageIndex:0,url:null,template:"#item-template",dataRequest:null,dataChange:null,itemClick:null,success:null,error:null,pullDown:null,isAutoRender:true,itemSelector:"li",isAutoProxy:undefined,delay:0,timeout:6e3,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},contentType:"application/x-www-form-urlencoded",headers:null,setting:{down:{},up:{isAuto:true}}};function a(t){var e=this;t=o.extend(true,{},u,t);var i=t.template;if(typeof i==="string"&&/^[.#]/.test(i)||i instanceof HTMLElement){var n=o.selector(i);if(n){i=n.innerHTML.toString()||""}}t.template=i;var s=t.theme||r;if(!s){throw new Error("错误:请检查传入的minirefresh主题是否正确!")}var a=t.setting;a.container=t.container;if(a.down){a.down.callback=function(){e._pullDownCallback()}}if(a.up){a.up.callback=function(){e._pullUpCallback()}}this.container=o.selector(t.container);this.listContainer=o.selector(t.listContainer);this.options=t;this.setting=a;this._initParams();this.instance=new s(a);this._addEvent()}return a.prototype={_log:function(t,e){this.options.isDebug&&console[t](e)},_initParams:function(){this.isNoMoreData=!1,this.currPage=this.options.initPageIndex,this.setting.up&&this.setting.up.isAuto&&this.currPage--},_pullDownCallback:function(){var t=this,e=this.options;this.isPullDown=!0,this.loadingDown=!0,this.currPage=e.initPageIndex,setTimeout(function(){t._ajaxRequest()},e.delay),e.pullDown&&e.pullDown()},_pullUpCallback:function(){var t=this;this.isrefresh||this.loadingUp||(this.isPullDown=!1,this.loadingUp=!0,this.currPage++,setTimeout(function(){t._ajaxRequest()},this.options.delay))},_clearResponseEl:function(){this.options.isAutoRender&&this.listContainer&&(this.listContainer.innerHTML="")},_render:function(t){var e=this.options,i=0;if(e.isAutoRender)if(this.isPullDown&&this._clearResponseEl(),p)if(t&&Array.isArray(t)&&0<t.length){for(var n="",s=0,a=t.length;s<a;s++){var o=t[s],r="",u=e.template;u&&("string"==typeof u?r=u:"function"==typeof u&&(r=u(o))),n+=p.render(r,o),i++}""!==n&&(this.listContainer.innerHTML+=n)}else this.isNoMoreData=!0;else this.isNoMoreData=!0,this._log(l,"error***没有包含mustache文件,无法进行模板渲染");return i},_dataChangeDefault:function(t){return e(t,{dataPath:["custom.infoList","custom.infolist","UserArea.InfoList"]}).data},_ajaxRequest:function(){var i=this,n=this.options;if(!n.url)return this._log(l,"error***url无效,无法访问"),void this._errorRequest(null,null,"请求url为空!");this.currPage>n.initPageIndex?n.up=!0:n.up=!1;function e(t){var e="",e="function"==typeof n.url?n.url():n.url;d({isAutoProxy:n.isAutoProxy,url:e,data:t,dataType:n.dataType||"json",timeout:n.timeout,type:n.type,accepts:n.accepts,headers:n.headers,contentType:n.contentType,isMinirefreshRefresh:!0,success:function(t){i._successRequest(t)},error:function(t,e){i._errorRequest(t,e,"请求失败!")}})}var t;n.dataRequest?void 0!==(t=n.dataRequest(this.currPage,function(t){e(t)}))&&e(t):(this._log(f,"warning***请注意dataRequest不存在,默认数据为空"),e())},_errorRequest:function(t,e,i){var n=this.options;this.isNoMoreData=!0,this._refreshState(!1),this.currPage--,this.currPage=this.currPage>=n.initPageIndex?this.currPage:n.initPageIndex,n.error&&n.error(t,e,i)},_successRequest:function(t){var e=this.options;if(!t)return this._log(f,"warning***返回的数据为空,请注意！"),this.isNoMoreData=!0,void this._refreshState(!1);this._log("log","下拉刷新返回数据:"+JSON.stringify(t)),t=e.dataChange?e.dataChange(t):this._dataChangeDefault(t);var i=this._render(t);this.loadingMoreSuccess&&(this.loadingMoreSuccess(),this.loadingMoreSuccess=null),e.success&&"function"==typeof e.success&&e.success(t,this.isPullDown||this.currPage===e.initPageIndex),this._refreshState(0<i,i)},_refreshState:function(t,e){e=e||0,this.isPullDown&&(this.instance.endDownLoading(t,"更新"+e+"条数据"),this.isNoMoreData&&(this.instance.resetUpLoading(),this.isNoMoreData=!1)),this.instance.endUpLoading(this.isNoMoreData),this.loadingDown=!1,this.loadingUp=!1,this.isrefresh=!1},_addEvent:function(){var t=this.listContainer,e=this.options,i=e.itemClick;"function"==typeof i&&n(t).on(s,e.itemSelector,i)},refresh:function(){this.options;this.isrefresh=!0,this._clearResponseEl(),this._pullDownCallback()},refreshNosense:function(){function e(t){return d({isAutoProxy:i.isAutoProxy,url:r,data:t,dataType:i.dataType||"json",timeout:i.timeout,type:i.type,accepts:i.accepts,headers:i.headers,contentType:i.contentType})}var t=this.currPage,i=this.options,n=i.initPageIndex,s=i.dataChange,a=i.template,o=this,r="",u="",l="",c=[],r="function"==typeof i.url?i.url():i.url;if(i.dataRequest)for(;n<=t;n++){var h=i.dataRequest(n,function(t){c.push(e(t))});void 0!==h&&c.push(e(h))}else this._log(f,"warning***请注意dataRequest不存在,默认数据为空"),c.push(e());Promise.all(c).then(function(t){t&&Array.isArray(t)&&t.forEach(function(t){var e="",e=s?s(t):o._dataChangeDefault(t);if(a&&("string"==typeof a?l=a:"function"==typeof a&&(l=a(e))),p&&e&&Array.isArray(e)&&0<e.length)for(var i=0,n=e.length;i<n;i++)u+=p.render(l,e[i])}),o.listContainer.innerHTML=u})},_ajaxRequestNosense:function(){var o=this,r=this.options;this.currPage>r.initPageIndex?r.up=!0:r.up=!1;function e(t){var e="",e="function"==typeof r.url?r.url():r.url;d({isAutoProxy:r.isAutoProxy,url:e,data:t,dataType:r.dataType||"json",timeout:r.timeout,type:r.type,accepts:r.accepts,headers:r.headers,contentType:r.contentType,success:function(t){if((t=u?r.dataChange(t):o._dataChangeDefault(t))&&Array.isArray(t)&&0<t.length)for(var e=0,i=t.length;e<i;e++){var n=t[e],s="",a=r.template;a&&("string"==typeof a?s=a:"function"==typeof a&&(s=a(n))),p.render(s,n)}},error:function(t,e){o._errorRequest(t,e,"请求失败!")}})}var t,u=r.dataChange;r.dataRequest?void 0!==(t=r.dataRequest(this.currPage,function(t){e(t)}))&&e(t):(this._log(f,"warning***请注意dataRequest不存在,默认数据为空"),e())},loadingMore:function(t){this.loadingMoreSuccess=t,this.isNoMoreData&&(this.instance.resetUpLoading(),this.isNoMoreData=!1),this.instance.triggerUpLoading()},refreshSetting:function(t){this.setting=o.extend(!0,{},this.setting,t),this.instance.refreshOptions(this.setting)},destroy:function(){n(this.listContainer).off(),this.container=null,this.listContainer=null,this.instance=null,this.options=null}},a}();"undefined"!=typeof module&&module.exports?exports.MiniRefreshBiz=e:"function"==typeof define&&(define.amd||define.cmd)&&define(function(){return e}),t.MiniRefreshBiz=e}("undefined"!=typeof window?window:global);