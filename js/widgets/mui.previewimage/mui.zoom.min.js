!function(_,o){var t=_.className("zoom"),e=_.className("zoom-scroller"),n="."+t,A="."+e,P="pinchstart",k="pinch",C="pinchend";"ongesturestart"in o&&(P="gesturestart",k="gesturechange",C="gestureend"),_.Zoom=function(o,t){var m=this;m.options=_.extend(_.Zoom.defaults,t),m.wrapper=m.element=o,m.scroller=o.querySelector(A),m.scrollerStyle=m.scroller&&m.scroller.style,m.zoomer=o.querySelector(n),m.zoomerStyle=m.zoomer&&m.zoomer.style,m.init=function(){_.options.gestureConfig.pinch=!0,_.options.gestureConfig.doubletap=!0,m.initEvents()},m.initEvents=function(o){var t=o?"removeEventListener":"addEventListener",e=m.scroller;e[t](P,m.onPinchstart),e[t](k,m.onPinch),e[t](C,m.onPinchend),e[t](_.EVENT_START,m.onTouchstart),e[t](_.EVENT_MOVE,m.onTouchMove),e[t](_.EVENT_CANCEL,m.onTouchEnd),e[t](_.EVENT_END,m.onTouchEnd),e[t]("drag",m.dragEvent),e[t]("doubletap",m.doubleTapEvent)},m.dragEvent=function(o){(f||c)&&o.stopPropagation()},m.doubleTapEvent=function(o){m.toggleZoom(o.detail.center)},m.transition=function(o,t){return t=t||0,o.webkitTransitionDuration=t+"ms",m},m.translate=function(o,t,e){return t=t||0,e=e||0,o.webkitTransform="translate3d("+t+"px,"+e+"px,0px)",m},m.scale=function(o,t){return t=t||1,o.webkitTransform="translate3d(0,0,0) scale("+t+")",m},m.scrollerTransition=function(o){return m.transition(m.scrollerStyle,o)},m.scrollerTransform=function(o,t){return m.translate(m.scrollerStyle,o,t)},m.zoomerTransition=function(o){return m.transition(m.zoomerStyle,o)},m.zoomerTransform=function(o){return m.scale(m.zoomerStyle,o)};var l=1,s=1,r=!1,c=!1;m.onPinchstart=function(o){c=!0},m.onPinch=function(o){r||(m.zoomerTransition(0),r=!0),(l=(o.detail?o.detail.scale:o.scale)*s)>m.options.maxZoom&&(l=m.options.maxZoom-1+Math.pow(l-m.options.maxZoom+1,.5)),l<m.options.minZoom&&(l=m.options.minZoom+1-Math.pow(m.options.minZoom-l+1,.5)),m.zoomerTransform(l)},m.onPinchend=function(o){l=Math.max(Math.min(l,m.options.maxZoom),m.options.minZoom),m.zoomerTransition(m.options.speed).zoomerTransform(l),s=l,r=!1},m.setZoom=function(o){l=s=o,m.scrollerTransition(m.options.speed).scrollerTransform(0,0),m.zoomerTransition(m.options.speed).zoomerTransform(l)},m.toggleZoom=function(o,t){var e,n,r,a,i;"number"==typeof o&&(t=o,o=void 0),t=void 0===t?m.options.speed:t,l&&1!==l?(l=s=1,m.scrollerTransition(t).scrollerTransform(0,0)):(l=s=m.options.maxZoom,o?(n=(e=_.offset(m.zoomer)).top,r=e.left,a=(o.x-r)*l,i=(o.y-n)*l,this._cal(),E<=a&&a<=E+u||a<E?a=E-a+u/2:E+u<a&&(a=E+u-a-u/2),x<=i&&i<=x+h||i<x?i=x-i+h/2:x+h<i&&(i=x+h-i-h/2),a=Math.min(Math.max(a,g),E),i=Math.min(Math.max(i,M),x),m.scrollerTransition(t).scrollerTransform(a,i)):m.scrollerTransition(t).scrollerTransform(0,0)),m.zoomerTransition(t).zoomerTransform(l)},m._cal=function(){u=m.wrapper.offsetWidth,h=m.wrapper.offsetHeight,z=m.zoomer.offsetWidth,v=m.zoomer.offsetHeight;var o=z*l,t=v*l;g=Math.min(u/2-o/2,0),E=-g,M=Math.min(h/2-t/2,0),x=-M};var u,h,p,f,T,d,g,M,E,x,z,v,a,i,y,w,Z,b,N,S={},V={};return m.onTouchstart=function(o){o.preventDefault(),p=!0,S.x=o.type===_.EVENT_START?o.targetTouches[0].pageX:o.pageX,S.y=o.type===_.EVENT_START?o.targetTouches[0].pageY:o.pageY},m.onTouchMove=function(o){var t,e,n;o.preventDefault(),p&&(f||(u=m.wrapper.offsetWidth,h=m.wrapper.offsetHeight,z=m.zoomer.offsetWidth,v=m.zoomer.offsetHeight,t=_.parseTranslateMatrix(_.getStyles(m.scroller,"webkitTransform")),a=t.x||0,i=t.y||0,m.scrollerTransition(0)),n=v*l,(e=z*l)<u&&n<h||(g=Math.min(u/2-e/2,0),E=-g,M=Math.min(h/2-n/2,0),x=-M,V.x=o.type===_.EVENT_MOVE?o.targetTouches[0].pageX:o.pageX,V.y=o.type===_.EVENT_MOVE?o.targetTouches[0].pageY:o.pageY,f||r||!(Math.floor(g)===Math.floor(a)&&V.x<S.x||Math.floor(E)===Math.floor(a)&&V.x>S.x)?(f=!0,T=V.x-S.x+a,d=V.y-S.y+i,T<g&&(T=g+1-Math.pow(g-T+1,.8)),E<T&&(T=E-1+Math.pow(T-E+1,.8)),d<M&&(d=M+1-Math.pow(M-d+1,.8)),x<d&&(d=x-1+Math.pow(d-x+1,.8)),y=y||V.x,b=b||V.y,w=w||_.now(),Z=(V.x-y)/(_.now()-w)/2,N=(V.y-b)/(_.now()-w)/2,Math.abs(V.x-y)<2&&(Z=0),Math.abs(V.y-b)<2&&(N=0),y=V.x,b=V.y,w=_.now(),m.scrollerTransform(T,d)):p=!1))},m.onTouchEnd=function(o){var t,e,n,r,a,i,s;o.touches.length||(c=!1),p&&f?(f=p=!1,n=T+Z*(t=300),r=d+N*(e=300),0!==Z&&(t=Math.abs((n-T)/Z)),0!==N&&(e=Math.abs((r-d)/N)),a=Math.max(t,e),T=n,d=r,i=z*l,s=v*l,g=Math.min(u/2-i/2,0),E=-g,M=Math.min(h/2-s/2,0),x=-M,T=Math.max(Math.min(T,E),g),d=Math.max(Math.min(d,x),M),m.scrollerTransition(a).scrollerTransform(T,d)):f=p=!1},m.destroy=function(){m.initEvents(!0),delete _.data[m.wrapper.getAttribute("data-zoomer")],m.wrapper.setAttribute("data-zoomer","")},m.init(),m},_.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},_.fn.zoom=function(e){var n=[];return this.each(function(){var o=null,t=this.getAttribute("data-zoomer");t?o=_.data[t]:(t=++_.uuid,_.data[t]=o=new _.Zoom(this,e),this.setAttribute("data-zoomer",t)),n.push(o)}),1===n.length?n[0]:n}}(mui,window);