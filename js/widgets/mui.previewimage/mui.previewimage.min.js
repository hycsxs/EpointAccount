!function(u,p){function t(e){this.options=u.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},e||{}),this.init(),this.initEvent()}var a="__DEFAULT",i=document.createElement("div"),e=t.prototype;e.init=function(){var e=this.options,t=document.getElementById(this.options.id);t||(i.innerHTML='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>'.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",e.header).replace("{{footer}}",e.footer),document.body.appendChild(i.firstElementChild),t=document.getElementById(this.options.id)),this.element=t,this.scroller=this.element.querySelector(u.classSelector(".slider-group")),this.indicator=this.element.querySelector(u.classSelector(".preview-indicator")),this.loader=this.element.querySelector(u.classSelector(".preview-loading")),e.footer&&this.element.querySelector(u.classSelector(".preview-footer")).classList.remove(u.className("hidden")),this.addImages()},e.initEvent=function(){var s=this;u(document.body).on("tap","img[data-preview-src]",function(){return s.open(this),!1});var e=null,t=function(){e=e||u.later(function(){s.loader.removeEventListener("tap",t),s.scroller.removeEventListener("tap",t),s.close()},300)};this.scroller.addEventListener("doubletap",function(){e&&(e.cancel(),e=null)}),this.element.addEventListener("webkitAnimationEnd",function(){s.element.classList.contains(u.className("preview-out"))?(s.element.style.display="none",s.element.classList.remove(u.className("preview-out")),s.element.classList.remove(u.className("preview-in")),e=null):(s.loader.addEventListener("tap",t),s.scroller.addEventListener("tap",t))}),this.element.addEventListener("slide",function(e){var t;!s.options.zoom||(t=s.element.querySelector(".mui-zoom-wrapper:nth-child("+(s.lastIndex+1)+")"))&&u(t).zoom().setZoom(1);var i=e.detail.slideNumber;s.lastIndex=i,s.indicator&&(s.indicator.innerText=i+1+"/"+s.currentGroup.length),s._loadItem(i)})},e.addImages=function(e,t){this.groups={};var i=[];if((i=e?e===a?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+e+"']"):document.querySelectorAll("img[data-preview-src]")).length)for(var s=0,r=i.length;s<r;s++)this.addImage(i[s])},e.addImage=function(e){var t=(t=e.getAttribute("data-preview-group"))||a;this.groups[t]||(this.groups[t]=[]);var i,s,r=e.getAttribute("src");e.__mui_img_data&&e.__mui_img_data.src===r?this.groups[t].push(e.__mui_img_data):(s={src:r,lazyload:r===(i=(i=e.getAttribute("data-preview-src"))||r)?"":i,loaded:r===i,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:e},this.groups[t].push(s),e.__mui_img_data=s)},e.empty=function(){this.scroller.innerHTML=""},e._initImgData=function(e,t){var i,s;e.sWidth||(i=e.el,e.sWidth=i.offsetWidth,e.sHeight=i.offsetHeight,s=u.offset(i),e.sTop=s.top,e.sLeft=s.left,e.sScale=Math.max(e.sWidth/p.innerWidth,e.sHeight/p.innerHeight)),t.style.webkitTransform="translate3d(0,0,0) scale("+e.sScale+")"},e._getScale=function(e,t){var i=e.width/t.width,s=e.height/t.height;return i<=s?e.height/(t.height*i):e.width/(t.width*s)},e._imgTransitionEnd=function(e){var t=e.target;t.classList.remove(u.className("transitioning")),t.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},e._loadItem=function(e,t){var i,s,r=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(e+1)+")")),a=this.currentGroup[e],n=r.querySelector("img");this._initImgData(a,n),t&&(i=this._getPosition(a),n.style.webkitTransitionDuration="0ms",n.style.webkitTransform="translate3d("+i.x+"px,"+i.y+"px,0) scale("+a.sScale+")",n.offsetHeight),!a.loaded&&n.getAttribute("data-preview-lazyload")?((s=this).loader.classList.add(u.className("active")),n.style.webkitTransitionDuration="0.5s",n.addEventListener("webkitTransitionEnd",s._imgTransitionEnd.bind(s)),n.style.webkitTransform="translate3d(0,0,0) scale("+a.sScale+")",this.loadImage(n,function(){a.loaded=!0,n.src=a.lazyload,s._initZoom(r,this.width,this.height),n.classList.add(u.className("transitioning")),n.addEventListener("webkitTransitionEnd",s._imgTransitionEnd.bind(s)),n.setAttribute("style",""),n.offsetHeight,s.loader.classList.remove(u.className("active"))})):(a.lazyload&&(n.src=a.lazyload),this._initZoom(r,n.width,n.height),n.classList.add(u.className("transitioning")),n.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),n.setAttribute("style",""),n.offsetHeight),this._preloadItem(e+1),this._preloadItem(e-1)},e._preloadItem=function(e){var t,i,s=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(e+1)+")"));s&&((t=this.currentGroup[e]).sWidth||(i=s.querySelector("img"),this._initImgData(t,i)))},e._initZoom=function(e,t,i){var s;this.options.zoom&&(e.getAttribute("data-zoomer")||("IMG"===e.querySelector(u.classSelector(".zoom")).tagName?(s=this._getScale({width:e.offsetWidth,height:e.offsetHeight},{width:t,height:i}),u(e).zoom({maxZoom:Math.max(s,1)})):u(e).zoom()))},e.loadImage=function(e,t){function i(){t&&t.call(this)}var s=new Image;s.onload=i,s.onerror=i,s.src=e.getAttribute("data-preview-lazyload")},e.getRangeByIndex=function(e,t){return{from:0,to:t-1}},e._getPosition=function(e){var t=e.sLeft-p.pageXOffset,i=e.sTop-p.pageYOffset;return{left:t,top:i,x:t-(p.innerWidth-e.sWidth)/2,y:i-(p.innerHeight-e.sHeight)/2}},e.refresh=function(e,t){for(var i=(this.currentGroup=t).length,s=[],r=this.getRangeByIndex(e,i),a=r.from,n=r.to+1,o=e,l="",d="",c=(p.innerWidth,p.innerHeight,0);a<n;a++,c++){var h=t[a],m="";h.sWidth&&(m="-webkit-transform:translate3d(0,0,0) scale("+h.sScale+");transform:translate3d(0,0,0) scale("+h.sScale+")"),d='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>'.replace("{{src}}",h.src).replace("{{lazyload}}",h.lazyload).replace("{{style}}",m),l=a===e?(o=c,u.className("active")):"",s.push(d.replace("{{className}}",l))}this.scroller.innerHTML=s.join(""),this.element.style.display="block",this.element.classList.add(u.className("preview-in")),this.lastIndex=o,this.element.offsetHeight,u(this.element).slider().gotoItem(o,0),this.indicator&&(this.indicator.innerText=o+1+"/"+this.currentGroup.length),this._loadItem(o,!0)},e.openByGroup=function(e,t){e=Math.min(Math.max(0,e),this.groups[t].length-1),this.refresh(e,this.groups[t])},e.open=function(e,t){this.isShown()||("number"==typeof e?(t=t||a,this.addImages(t,e),this.openByGroup(e,t)):(t=(t=e.getAttribute("data-preview-group"))||a,this.addImages(t,e),this.openByGroup(this.groups[t].indexOf(e.__mui_img_data),t)))},e.close=function(e,t){if(this.isShown()){this.element.classList.remove(u.className("preview-in")),this.element.classList.add(u.className("preview-out"));var i,s,r,a,n=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")).querySelector("img");n&&(n.classList.add(u.className("transitioning")),i=this.currentGroup[this.lastIndex],r=(s=this._getPosition(i)).left,(a=s.top)>p.innerHeight||r>p.innerWidth||a<0||r<0?(n.style.opacity=0,n.style.webkitTransitionDuration="0.5s",n.style.webkitTransform="scale("+i.sScale+")"):(this.options.zoom&&u(n.parentNode.parentNode).zoom().toggleZoom(0),n.style.webkitTransitionDuration="0.5s",n.style.webkitTransform="translate3d("+s.x+"px,"+s.y+"px,0) scale("+i.sScale+")"));for(var o=this.element.querySelectorAll(u.classSelector(".zoom-wrapper")),l=0,d=o.length;l<d;l++)u(o[l]).zoom().destroy();u(this.element).slider().destroy()}},e.isShown=function(){return this.element.classList.contains(u.className("preview-in"))};var s=null;u.previewImage=function(e){return s=s||new t(e)},u.getPreviewImage=function(){return s}}(mui,window);