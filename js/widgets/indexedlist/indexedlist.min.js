!function(){"use strict";var e={isAutoProxy:void 0,container:"#indexlist"};function t(t){t=Util.extend({},e,t),this.container=Util.selector(t.container),this._initData(t)}t.prototype={_initData:function(t){if(t.data=t.data||[],this.options=t,!this._validate())throw new Error("验证错误，索引列表的传入格式非法，请检查代码");this._render(),this._addEvent(),this._dealUrl()},_render:function(){this._selector("body").style.height="100%",this._selector("html").style.height="100%";var t=this._getTemplate();this._selector(this.options.container).innerHTML=t;var e=this.options.data,i=this._renderGenHtml(e);this._selector("#indexedListData").innerHTML=i;var a=this._selector("#indexedList");a.style.height=document.body.offsetHeight+"px",new mui.IndexedList(a)},_addEvent:function(){var i=this.options.itemClick;mui(this.options.container).on("tap","li",function(t){var e;this.classList.contains("mui-indexed-list-item")&&(e={text:this.innerText,value:this.id},i&&i.call(this,e))})},_dealUrl:function(){var t,i=this,a=this.options;a.url&&(a.success=function(t){var e=a.dataChange?a.dataChange(t):Util.dataProcess(t,{dataPath:["custom.infolist","custom.infoList"]}).data;e&&(a.data=e,i._render())},(t=Util.extend({},a)).data=t.dataRequest,Util.ajax(t))},_getTemplate:function(){return'<div id="indexedList" class="mui-indexed-list">\t\t\t\t<div class="mui-indexed-list-search mui-input-row mui-search">\t\t\t\t\t<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="按字母搜索关键字">\t\t\t\t</div>\t\t\t\t<div class="mui-indexed-list-bar">\t\t\t\t\t<a>A</a>\t\t\t\t\t<a>B</a>\t\t\t\t\t<a>C</a>\t\t\t\t\t<a>D</a>\t\t\t\t\t<a>E</a>\t\t\t\t\t<a>F</a>\t\t\t\t\t<a>G</a>\t\t\t\t\t<a>H</a>\t\t\t\t\t<a>I</a>\t\t\t\t\t<a>J</a>\t\t\t\t\t<a>K</a>\t\t\t\t\t<a>L</a>\t\t\t\t\t<a>M</a>\t\t\t\t\t<a>N</a>\t\t\t\t\t<a>O</a>\t\t\t\t\t<a>P</a>\t\t\t\t\t<a>Q</a>\t\t\t\t\t<a>R</a>\t\t\t\t\t<a>S</a>\t\t\t\t\t<a>T</a>\t\t\t\t\t<a>U</a>\t\t\t\t\t<a>V</a>\t\t\t\t\t<a>W</a>\t\t\t\t\t<a>X</a>\t\t\t\t\t<a>Y</a>\t\t\t\t\t<a>Z</a>\t\t\t\t</div>\t\t\t\t<div class="mui-indexed-list-alert"></div>\t\t\t\t<div class="mui-indexed-list-inner">\t\t\t\t\t<div class="mui-indexed-list-empty-alert">没有数据</div>\t\t\t\t\t<ul class="mui-table-view community-list" id="indexedListData">\t\t\t\t\t</ul>\t\t\t\t</div>\t\t\t</div>'},_renderGenHtml:function(t){var a="";if(!t||!Array.isArray(t))throw new Error("传入data参数必须是JSON数组且不为空！");return mui.each(t,function(t,e){if(e.firstletter=e.firstletter.toUpperCase(),a+='<li data-group="'+e.firstletter+'" class="mui-table-view-divider mui-indexed-list-group">'+e.firstletter+"</li>",!e.category||!Array.isArray(e.category))throw new Error("传入IndexedList参数必须是数组且不为空！");var i=e.category;mui.each(i,function(t,e){a+=Mustache.render('<li class="mui-table-view-cell mui-indexed-list-item" id="{{value}}">{{text}}</li>',e)})}),a},_validate:function(){var t=this.options.data,e=!0;return this.container&&t&&Array.isArray(t)||(e=!1),e},_selector:function(t){return document.querySelector(t)}},window.IndexedList=t}(),function(u,s){function h(t){return"."+u.className(t)}var a=u.IndexedList=u.Class.extend({init:function(t,e){var i=this;if(i.options=e||{},i.box=t,!i.box)throw"实例 IndexedList 时需要指定 element";i.createDom(),i.findElements(),i.caleLayout(),i.bindEvent()},createDom:function(){var t=this;t.el=t.el||{},t.el.styleForSearch=s.createElement("style"),(s.head||s.body).appendChild(t.el.styleForSearch)},findElements:function(){var t=this;t.el=t.el||{},t.el.search=t.box.querySelector(h("indexed-list-search")),t.el.searchInput=t.box.querySelector(h("indexed-list-search-input")),t.el.searchClear=t.box.querySelector(h("indexed-list-search")+" "+h("icon-clear")),t.el.bar=t.box.querySelector(h("indexed-list-bar")),t.el.barItems=[].slice.call(t.box.querySelectorAll(h("indexed-list-bar")+" a")),t.el.inner=t.box.querySelector(h("indexed-list-inner")),t.el.items=[].slice.call(t.box.querySelectorAll(h("indexed-list-item"))),t.el.liArray=[].slice.call(t.box.querySelectorAll(h("indexed-list-inner")+" li")),t.el.alert=t.box.querySelector(h("indexed-list-alert"))},caleLayout:function(){var t=this,e=t.box.offsetHeight-t.el.search.offsetHeight+"px";t.el.bar.style.height=e,t.el.inner.style.height=e;var i=(t.el.bar.offsetHeight-40)/t.el.barItems.length+"px";t.el.barItems.forEach(function(t){t.style.height=i,t.style.lineHeight=i})},scrollTo:function(t){var e=this,i=e.el.inner.querySelector('[data-group="'+t+'"]');!i||e.hiddenGroups&&-1<e.hiddenGroups.indexOf(i)||(e.el.inner.scrollTop=i.offsetTop)},bindBarEvent:function(){function e(t){n&&(n.classList.remove("active"),n=null),a.el.bar.classList.add("active");var e,i=t.changedTouches?t.changedTouches[0]:t;!(n=s.elementFromPoint(i.pageX,i.pageY))||(e=n.innerText)&&1==e.length&&(n.classList.add("active"),a.el.alert.innerText=e,a.el.alert.classList.add("active"),a.scrollTo(e)),t.preventDefault()}function i(t){a.el.alert.classList.remove("active"),a.el.bar.classList.remove("active"),n&&(n.classList.remove("active"),n=null)}var a=this,n=null;a.el.bar.addEventListener(u.EVENT_MOVE,function(t){e(t)},!1),a.el.bar.addEventListener(u.EVENT_START,function(t){e(t)},!1),s.body.addEventListener(u.EVENT_END,function(t){i()},!1),s.body.addEventListener(u.EVENT_CANCEL,function(t){i()},!1)},search:function(s){var i=this;s=(s||"").toLowerCase();var r=[],a=-1,l=0,d=i.el.liArray,o=d.length;i.hiddenGroups=[];function c(t,e){t-a-(e?0:1)<=l&&(r.push(h("indexed-list-inner li")+":nth-child("+(a+1)+")"),i.hiddenGroups.push(d[a])),a=t,l=0}d.forEach(function(t){var e,i,a,n=d.indexOf(t);t.classList.contains(u.className("indexed-list-group"))?c(n,!1):(e=(t.innerText||"").toLowerCase(),i=(t.getAttribute("data-value")||"").toLowerCase(),a=(t.getAttribute("data-tags")||"").toLowerCase(),s&&e.indexOf(s)<0&&i.indexOf(s)<0&&a.indexOf(s)<0&&(r.push(h("indexed-list-inner li")+":nth-child("+(n+1)+")"),l++),o-1<=n&&c(n,!0))}),r.length>=o?i.el.inner.classList.add("empty"):0<r.length?(i.el.inner.classList.remove("empty"),i.el.styleForSearch.innerText=r.join(", ")+"{display:none;}"):(i.el.inner.classList.remove("empty"),i.el.styleForSearch.innerText="")},bindSearchEvent:function(){var e=this;e.el.searchInput.addEventListener("input",function(){var t=this.value;e.search(t)},!1),u(e.el.search).on("tap",h("icon-clear"),function(){e.search("")},!1)},bindEvent:function(){this.bindBarEvent(),this.bindSearchEvent()}});u.fn.indexedList=function(i){return this.each(function(t,e){e.indexedList||(e.indexedList=new a(e,i))}),this[0]?this[0].indexedList:null}}(mui,(window,document));