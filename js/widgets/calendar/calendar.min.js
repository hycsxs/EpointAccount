!function(){"use strict";var t={container:"#calendar",isLunar:!0,isSwipeH:!0,isSwipeV:!0};function n(n){n=mui.extend({},t,n),this.container=this._selector(n.container),this._initData(n)}n.prototype={_initData:function(n){if(this.options=n,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var n=this;n.newDate=new Date,n.nowYear=n.newDate.getFullYear(),n.nowMonth=n.newDate.getMonth()+1,n.nowDay=n.newDate.getDate(),n.nowMonth=String(n.nowMonth),1==n.nowMonth.length&&(n.nowMonth="0"+n.nowMonth),n.CalendarData=new Array(100),n.madd=new Array(12),n.tgString="甲乙丙丁戊己庚辛壬癸",n.dzString="子丑寅卯辰巳午未申酉戌亥",n.numString="一二三四五六七八九十",n.monString="正二三四五六七八九十冬腊",n.weekString="日一二三四五六",n.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",n.cYear,n.cMonth,n.cDay,n.TheDate,n.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),n.madd[0]=0,n.madd[1]=31,n.madd[2]=59,n.madd[3]=90,n.madd[4]=120,n.madd[5]=151,n.madd[6]=181,n.madd[7]=212,n.madd[8]=243,n.madd[9]=273,n.madd[10]=304,n.madd[11]=334,this.refresh(n.nowYear,n.nowMonth,n.nowDay)},refresh:function(n,t,a){var e=this;e.nowYear=parseInt(n),e.nowMonth=parseInt(t),e.nowDay=parseInt(a),9<parseInt(e.nowMonth)?e.nowMonth=""+parseInt(e.nowMonth):e.nowMonth="0"+parseInt(e.nowMonth),9<parseInt(e.nowDay)?e.nowDay=""+parseInt(e.nowDay):e.nowDay="0"+parseInt(e.nowDay);var o=new Date(Date.parse(e.nowYear+"/"+e.nowMonth+"/1")).getDay();0==(o=parseInt(o))&&(o=7);for(var r=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth),s={},i=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth-1),i=parseInt(i),h=o;0<h;h--){var d=i--,w="lunar"+h;s["day"+h]=d,s[w]=this._getLunar(d,"m-1")}var p=0;if("28"==r){p=28+o;for(var h=o+1,c=1;h<28+o+1;h++,c++){w="lunar"+h;s["day"+h]=c,s[w]=this._getLunar(c)}}if("29"==r){p=29+o;for(h=o+1,c=1;h<29+o+1;h++,c++){w="lunar"+h;s["day"+h]=c,s[w]=this._getLunar(c)}}if("30"==r){p=30+o;for(h=o+1,c=1;h<30+o+1;h++,c++){w="lunar"+h;s["day"+h]=c,s[w]=this._getLunar(c)}}if("31"==r){p=31+o;for(h=o+1,c=1;h<31+o+1;h++,c++){w="lunar"+h;s["day"+h]=c,s[w]=this._getLunar(c)}}for(var u=p+1,l=1;u<=42;u++,l++){w="lunar"+u;s["day"+u]=l,s[w]=this._getLunar(l,"m+1")}this._render(s)},_render:function(n){for(var t=this,a=[],e=1;e<43;e++)a.push({day_index:"{{day"+e+"}}",lunar_index:"{{lunar"+e+"}}"});var o="";o+='<table id="dateBorder">',o+="<tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>";for(var r=1;r<7;r++){o+="<tr>";for(var s="",i=7;0<i;i--){var h=7*r-i+1;s+=Mustache.render('<td><div class="dateQuan"><span class="day" data-value="{{day_index}}">{{day_index}}</span><span class="font12">{{lunar_index}}</span></div></td>',a[h-1])}o+=s,o+="</tr>"}o+="</table>";s=Mustache.render(o,n);this._selector(this.options.container).innerHTML=s;for(var d=0;d<=41&&1!=parseInt(Zepto("td")[d].innerText);d++)Zepto(Zepto("td")[d]).css("color","#D8D8D8"),Zepto(Zepto("td")[d]).find("div.dateQuan").addClass("nouse");for(var w=41;0<=w;w--){if(1==parseInt(Zepto("td")[w].innerText)){Zepto(Zepto("td")[w]).css("color","#D8D8D8"),Zepto(Zepto("td")[w]).find("div.dateQuan").addClass("nouse");break}Zepto(Zepto("td")[w]).css("color","#D8D8D8"),Zepto(Zepto("td")[w]).find("div.dateQuan").addClass("nouse")}var p=new Date,c=p.getFullYear(),u=p.getMonth()+1;c==t.nowYear&&u==t.nowMonth&&Zepto(".dateQuan").each(function(){var n;Zepto(this).hasClass("nouse")||(n=Zepto(this).text(),t.nowDay==parseInt(n)&&(Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive").html("<span class='day' data-value='"+t.nowDay+"'>今天</span><span class='font12'>"+n.substr(-2,2)+"<span>")))})},_addEvent:function(){var e=this,o=e.options.itemClick,n=e.options.swipeCallback;mui(e.options.container).on("tap",".dateQuan",function(){var n,t,a=this.querySelector(".font12").innerText.trim();Zepto(this).hasClass("nouse")||(Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive"),n=this.querySelector(".day").getAttribute("data-value"),n=9<parseInt(n)?""+parseInt(n):"0"+parseInt(n),t=e.nowYear+"-"+e.nowMonth+"-"+n,o&&o({date:t,lunar:a}))}),e.options.isSwipeH&&(e._selector(e.options.container).addEventListener("swiperight",function(){e.options.isDebug&&console.log("你正在向右滑动"),e.nowMonth=parseInt(e.nowMonth)-parseInt(1),0==e.nowMonth&&(e.nowYear=e.nowYear-1,e.nowMonth=12),9<parseInt(e.nowMonth)?e.nowMonth=""+parseInt(e.nowMonth):e.nowMonth="0"+parseInt(e.nowMonth),9<parseInt(e.nowDay)?e.nowDay=""+parseInt(e.nowDay):e.nowDay="0"+parseInt(e.nowDay),e.refresh(e.nowYear,e.nowMonth,e.nowDay),n&&n({year:e.nowYear,month:e.nowMonth,day:e.nowDay})}),e._selector(e.options.container).addEventListener("swipeleft",function(){e.options.isDebug&&console.log("你正在向左滑动"),e.nowMonth=parseInt(e.nowMonth)+parseInt(1),13==e.nowMonth&&(e.nowYear=e.nowYear+1,e.nowMonth=1),9<parseInt(e.nowMonth)?e.nowMonth=""+parseInt(e.nowMonth):e.nowMonth="0"+parseInt(e.nowMonth),9<parseInt(e.nowDay)?e.nowDay=""+parseInt(e.nowDay):e.nowDay="0"+parseInt(e.nowDay),e.refresh(e.nowYear,e.nowMonth,e.nowDay),n&&n({year:e.nowYear,month:e.nowMonth,day:e.nowDay})})),e.options.isSwipeV},_getLunar:function(n,t){var a=this.nowYear,e=this.nowMonth,e=parseInt(e);"m+1"===t&&13==(e=1+e)&&(e=1),"m-1"===t&&0==(e=-1+e)&&(e=1);var o=n;new Date(Date.parse(a+"/"+e+"/"+o)).getDay();return this._getLunarDay(a,e,o)},_judgeDaysByYearMonth:function(n,t){if(null==n||null==n)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(null==t||null==t)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";n=parseInt(n);return 0==(t=parseInt(t))&&(n--,t=12),2==t?n%4==0&&n%100!=0||n%400==0?"29":"28":this._inArray(t,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var n=!0;return this.options.container||(n=!1),n},_selector:function(n){return document.querySelector(n)},_inArray:function(n,t){if(!Array.isArray(t))throw"arguments is not Array";for(var a=0,e=t.length;a<e;a++)if(n==t[a])return!0;return!1},_sibling:function(n,t){for(var a=n.parentNode.firstChild;a;a=a.nextSibling)1===a.nodeType&&a!==n&&t&&"function"==typeof t&&t(a)},_getBit:function(n,t){return n>>t&1},_e2c:function(){var n,t,a,e,o=this;o.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var r=!1,s=o.TheDate.getYear();for(s<1900&&(s+=1900),n=365*(s-1921)+Math.floor((s-1921)/4)+o.madd[o.TheDate.getMonth()]+o.TheDate.getDate()-38,o.TheDate.getYear()%4==0&&1<o.TheDate.getMonth()&&n++,t=0;;t++){for(a=e=o.CalendarData[t]<4095?11:12;0<=a;a--){if(n<=29+o._getBit(o.CalendarData[t],a)){r=!0;break}n=n-29-o._getBit(o.CalendarData[t],a)}if(r)break}o.cYear=1921+t,o.cMonth=e-a+1,o.cDay=n,12==e&&(o.cMonth==Math.floor(o.CalendarData[t]/65536)+1&&(o.cMonth=1-o.cMonth),o.cMonth>Math.floor(o.CalendarData[t]/65536)+1&&o.cMonth--)},_getcDateString:function(){var n=this,t="";return n.cMonth,t+=n.cDay<11?"初":n.cDay<20?"十":n.cDay<30?"廿":"三十",n.cDay%10==0&&10!=n.cDay||(t+=n.numString.charAt((n.cDay-1)%10)),t},_getLunarDay:function(n,t,a){return n<1921||2080<n?"":(t=0<parseInt(t)?t-1:11,this._e2c(n,t,a),this._getcDateString())}},window.Calendar=n}();