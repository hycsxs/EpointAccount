"use strict";var preview=window.preview||function(e,o){return e.openPreviewUrl=function(e){var o=this;e={url:e.url||"default url",data:e.data||{},successCB:e.successCB||function(){},errorCB:e.errorCB||function(){},isDebug:e.isDebug||!1,fileName:e.fileName||"",reDownloaded:e.reDownloaded||"1"};var n=e.fileName,r="doc,docx,rtf,xls,xlsx,ppt,pptx,pdf,zip,rar,7z,wps,txt,png,jpg,jpeg,gif",i=Util.getPathSuffix(n);if("-1"!=r.indexOf(i.toLowerCase())||""==n){var t,u=Config.previewUrl,a=u.match(/furl=/);e.url=e.url.replace(new RegExp(Config.oldDownloadUrl,"g"),Config.newDownloadUrl),n&&(n=encodeURIComponent(n)+"("+o.getGuid(e.url)+")"),ejs.util.invokePluginApi({path:"contact.provider.serverOperation",dataMap:{method:"getPersonalDetailInfo"},success:function(o){var r=o.displayname,i=o.ouname;a&&a.length>0&&n?(u=u.replace(/furl=/,""),t=u+"fname="+n+"&tp=1;"+r+","+i+"&furl="+e.url):(u=u.replace(/furl=/,""),t=u+"&furl="+e.url),e.isDebug&&ejs.ui.showDebugDialog(t),ejs.auth.getToken({success:function(o){t+="&access_token="+o.access_token,ejs.page.open({pageUrl:t,orientation:-1,pageStyle:1,success:function(o){e.successCB&&e.successCB(o)}})},error:function(e){callback("")}})},error:function(e){alert(JSON.stringify(e))}})}else preview.downloadFile({url:e.url,fileName:e.fileName,reDownloaded:e.reDownloaded,isBackground:0},function(){ejs.ui.toast("文件下载完成")})},e.getGuid=function(e){return e.replace(/^.+?attachguid=/i,"")},e.downloadFile=function(e,o){e.isBackground?e.isBackground=e.isBackground.toString():e.isBackground="1",e.openAfterComplete=e.openAfterComplete||"1","1"==e.isBackground&&ejs.ui.showWaiting("努力下载中..."),ejs.io.downloadFile({url:e.url,fileName:e.fileName,isBackground:e.isBackground,reDownloaded:e.reDownloaded||"1",openAfterComplete:e.openAfterComplete,success:function(n){"1"==e.isBackground&&ejs.ui.closeWaiting(),"1"!=e.openAfterComplete&&o&&"function"==typeof o&&o(n)},error:function(e){ejs.ui.toast("下载错误"+JSON.stringify(e))}})},"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&(define.amd||define.cmd)&&define(function(){return e}),e}({});