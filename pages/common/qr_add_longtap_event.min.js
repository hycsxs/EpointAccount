!function(e,t,n){"use strict";function o(e){var t=this,n=document.querySelectorAll(e+" img");document.documentElement.style.webkitTouchCallout="none",document.documentElement.style.webkitUserSelect="none",[].forEach.call(n,function(e,n){1!=e.getAttribute("noqr")&&e.getAttribute("src")&&t.picUrlToPageUrl(e.src,function(t){e.setAttribute("imgurl",t)})}),mui.init({gestureConfig:{longtap:!0}}),mui(e).off("longtap","[imgurl]"),mui(e).on("longtap","[imgurl]",function(){var e=this.getAttribute("imgurl");t.isExternalUrl(e)&&ejs.ui.actionSheet({items:["识别图中二维码"],cancelable:1,success:function(t){0==t.which&&ejs.page.open({pageUrl:e,pageStyle:1,orientation:1,data:{key1:"value1"},success:function(e){}})},error:function(e){}})})}o.prototype={picUrlToPageUrl:function(e,t){var n=this,o=e;/http/.test(o)&&ejs.io.downloadFile({url:o,fileName:Util.uuid()+".jpg",reDownloaded:1,success:function(e){console.log("imgPath"+JSON.stringify(e));var i=e.filePath;ejs.util.recognizeQRCode({imgPath:i,imgBase64:"",success:function(e){if(ejs.io.deleteFile({path:i,success:function(e){},error:function(e){}}),e){console.log(e);var o=e.corePath;n.isExternalUrl(o)&&t&&t(o)}},error:function(e){console.log("失败网址："+o)}})},error:function(e){alert(JSON.stringify(e))}})},convertFileToDataURLviaFileReader:function(e,t){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.send()},isExternalUrl:function(e){var t=/^(\/\/|http|https|ftp|file)/;return this.checkReg(t,e)},checkReg:function(e,t){return!!t&&e.test(t)===!0}},n.QRtoLongTap=o}({},document,window);